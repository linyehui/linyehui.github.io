<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"linyehui.me","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="HABIT IS POWER">
<meta property="og:type" content="website">
<meta property="og:title" content="HABIT IS POWER">
<meta property="og:url" content="http://linyehui.me/page/7/index.html">
<meta property="og:site_name" content="HABIT IS POWER">
<meta property="og:description" content="HABIT IS POWER">
<meta property="og:locale">
<meta property="article:author" content="linyehui">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://linyehui.me/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>HABIT IS POWER</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HABIT IS POWER</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">习惯就是力量</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/05/21/2014/2014-05-21-nexus-s-front-camera-mediarecorder-start-failed-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/05/21/2014/2014-05-21-nexus-s-front-camera-mediarecorder-start-failed-19/" class="post-title-link" itemprop="url">Nexus S 前置摄像头MediaRecorder start failed -19</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-05-21 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-21T00:00:00+08:00">2014-05-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>前几天解决了Android下的这个问题：<a target="_blank" rel="noopener" href="http://www.linyehui.com/mediarecorder-start-failed-19">MediaRecorder.start failed: -19</a>，后面发现没有彻底解决：<br><strong>在Nexus S这部“神机”下，如果使用前置摄像头进行录像，还是会出现start failed -19</strong></p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>判断是Nexus S，而且使用的是前置摄像头，调用setVideoFrameRate设置为15，解决。<br>参考文章是这篇：<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/14681703/android-cant-record-video-with-front-facing-camera-mediarecorder-start-failed">Android cant record video with Front Facing Camera, MediaRecorder start failed: -19</a></p>
<p><strong>原文是这样的：</strong></p>
<blockquote>
<p>So, if I use the QUALITY_LOW profile AND set the frame-rate to 15 or lower, it magically works.</p>
<p>mediaRecorder.setProfile(CamcorderProfile.get(CamcorderProfile.QUALITY_LOW));<br>mediaRecorder.setVideoFrameRate(15);<br>Infact any value, 1 - 15 works. Which seems weird.</p>
</blockquote>
<p><strong>不过我用CamcorderProfile.QUALITY_HIGH也是没问题的，关键是mediaRecorder.setVideoFrameRate(15);</strong></p>
<h2 id="贴下我的代码："><a href="#贴下我的代码：" class="headerlink" title="贴下我的代码："></a>贴下我的代码：</h2><pre><code>// ... 此处省略代码若干

            CamcorderProfile profile = CamcorderProfile.get(CamcorderProfile.QUALITY_HIGH);
            
            profile.fileFormat = MediaRecorder.OutputFormat.MPEG_4;
            profile.videoCodec = MediaRecorder.VideoEncoder.H264;
            profile.audioCodec = MediaRecorder.AudioEncoder.AAC;

            // 设置videoFrameRate会导致Nexus S后置摄像头异常退出-19
            // 但不设置，或者设置的不是15以下的值，Nexus S前置摄像头会异常退出-19
            // @linyehui
            if (isModelNexusS())
            &#123;
                if (!cameraManager.isUseBackCamera())
                &#123;
                    profile.videoFrameRate = 15;
                &#125;
            &#125;
            else
            &#123;
                profile.videoFrameRate = Math.min(HJW_VIDEO_FRAME_RATE, profile.videoFrameRate);
            &#125;

            // ... 此处省略代码若干

    private boolean isModelNexusS() &#123;
         final String MODLE_NEXUS_S = &quot;Nexus S&quot;;
         Log.i(LOG_TAG, &quot;MODEL: &quot; + android.os.Build.MODEL);
         
         if (android.os.Build.MODEL.equalsIgnoreCase(MODLE_NEXUS_S))
             return true;
         else
             return false;
    &#125;
</code></pre>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>我目前的做法就是对Nexus S这种神机进行适配：</p>
<ul>
<li>如果是Nexus S，前置摄像头，设置videoFrameRate 为 15</li>
<li>如果是Nexus S，后置摄像头，就不要设置videoFrameRate </li>
<li>如果不是Nexus S，正常设置videoFrameRate 即可</li>
</ul>
<p>– End –</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/05/15/2014/2014-05-15-mediarecorder-start-failed-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/05/15/2014/2014-05-15-mediarecorder-start-failed-19/" class="post-title-link" itemprop="url">MediaRecorder.start failed: -19</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-05-15 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-15T00:00:00+08:00">2014-05-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>Android下，使用MediaRecorder进行视频录制，同一段代码在小米2S下代码运行正常，但是在Nexux S下会直接异常退出，log如下：</p>
<blockquote>
<p>05-15 16:22:21.631: E&#x2F;MediaRecorder(9265): start failed: -19<br>05-15 16:22:21.635: W&#x2F;System.err(9265): java.lang.RuntimeException: start failed.<br>05-15 16:22:21.639: W&#x2F;System.err(9265): 	at android.media.MediaRecorder.start(Native Method)</p>
</blockquote>
<h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><h3 id="去掉对VideoFrameRate的设置："><a href="#去掉对VideoFrameRate的设置：" class="headerlink" title="去掉对VideoFrameRate的设置："></a>去掉对VideoFrameRate的设置：</h3><blockquote>
<p>mediaRecorder.setVideoFrameRate(24);<br>或者<br>profile.videoFrameRate &#x3D; Math.min(24);</p>
</blockquote>
<p><strong>参考这个</strong>：<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/11249642/mediarecorder-start-failed-19">Mediarecorder start failed -19</a></p>
<h3 id="不过我这还遇到了比其他网友更奇怪的问题："><a href="#不过我这还遇到了比其他网友更奇怪的问题：" class="headerlink" title="不过我这还遇到了比其他网友更奇怪的问题："></a>不过我这还遇到了比其他网友更奇怪的问题：</h3><p>直接使用MediaRecorer的set方法会异常退出，但是get CamcorderProfile后进行相应的修改就能正常运行</p>
<p>下面这两份代码的视频和音频格式参数都是一样的，但是上面这种写法会导致异常退出：</p>
<blockquote>
<p>05-15 16:22:21.631: E&#x2F;MediaRecorder(9265): start failed: -19<br>05-15 16:22:21.635: W&#x2F;System.err(9265): java.lang.RuntimeException: start failed.<br>05-15 16:22:21.639: W&#x2F;System.err(9265): 	at android.media.MediaRecorder.start(Native Method)</p>
</blockquote>
<h4 id="失败"><a href="#失败" class="headerlink" title="失败"></a>失败</h4><pre><code>// 失败 -19 异常退出
CamcorderProfile profile = CamcorderProfile.get(CamcorderProfile.QUALITY_HIGH);
mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);
mediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264);
mediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);
//mediaRecorder.setVideoFrameRate(24);
mediaRecorder.setVideoEncodingBitRate(1000 * 1024);
mediaRecorder.setAudioEncodingBitRate(42 * 1024);
mediaRecorder.setAudioSamplingRate(44100);
mediaRecorder.setAudioChannels(2);
mediaRecorder.setVideoSize(640, 480);
</code></pre>
<h4 id="成功"><a href="#成功" class="headerlink" title="成功"></a>成功</h4><pre><code>// 成功
CamcorderProfile profile = CamcorderProfile.get(CamcorderProfile.QUALITY_HIGH);    		
profile.fileFormat = MediaRecorder.OutputFormat.MPEG_4;
profile.videoCodec = MediaRecorder.VideoEncoder.H264;
profile.audioCodec = MediaRecorder.AudioEncoder.AAC;
            
// 设置videoFrameRate会导致Nexus S下异常退出-19 @linyehui
//profile.videoFrameRate = 24;
profile.videoBitRate = 1000 * 1024;
profile.audioBitRate = 42 * 1024;
profile.audioSampleRate = 44100;
profile.audioChannels = 2;        

mediaRecorder.setProfile(profile);
mediaRecorder.setVideoSize(640, 480);
</code></pre>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>会导致MediaRecorder start时-19异常退出，主要有两个原因：</p>
<ol>
<li><p>mediaRecorder.setVideoSize设置的大小硬件不支持<br><strong>解决方案</strong>：<br>先用getSupportedPreviewSizes获取硬件支持的分辨率再使用</p>
</li>
<li><p>mediaRecorder.setVideoFrameRate设置的参数硬件不支持<br><strong>解决方案</strong>：<br>暂时没找到好的办法，我的方法是先不用<br>（应该有方法可以获取硬件支持的这个信息，然后根据硬件支持的参数来设置就可以了）</p>
</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/9271349/error-when-using-camera-on-android-4-nexus-s">Error when Using Camera on Android 4&#x2F;Nexus s</a>  </p>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/10496969/android-mediarecorder-start-failed-19">Android MediaRecorder - “start failed: -19”</a>  </p>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/11249642/mediarecorder-start-failed-19">Mediarecorder start failed -19</a>  </p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/netwalk/article/details/17686993">Error处理： android.media.MediaRecorder.start(Native Method) 报错：start failed: -19</a>  </p>
<p>– End –</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/05/09/2014/2014-05-09-how-to-build-ffmpeg-for-android-on-mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/05/09/2014/2014-05-09-how-to-build-ffmpeg-for-android-on-mac/" class="post-title-link" itemprop="url">在Mac上编译FFmpeg的Android版本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-05-09 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-09T00:00:00+08:00">2014-05-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>How to Build FFmpeg for Android On Mac</p>
<p>官方文档在这：<a target="_blank" rel="noopener" href="https://trac.ffmpeg.org/wiki/CompilationGuide/Android">CompilationGuide&#x2F;Android</a>  </p>
<p>关于Android上的FFmpeg入门，这个Blog不错：<a target="_blank" rel="noopener" href="http://www.roman10.net/category/android-tutorial/ffmpeg-on-android/">roman10 ffmpeg on Android</a>  </p>
<h1 id="关于FFmpeg耻辱名单"><a href="#关于FFmpeg耻辱名单" class="headerlink" title="关于FFmpeg耻辱名单"></a>关于FFmpeg耻辱名单</h1><p>使用开源代码，第一步一定是确认开源协议所带来的风险，确认后我们才能决定是否使用这一开源代码。</p>
<p>特别是暴风影音和QQ影音让大家知道了FFmpeg的耻辱名单：<a target="_blank" rel="noopener" href="http://ffmpeg.org/shame.html">Hall of Shame</a>，我们更得先研究下FFmpeg的开源协议了。</p>
<p>被加入这个名单的直接原因是这些产品违反了FFmpeg的开源协议，但具体是违反了那个开源协议呢？这就得从<a target="_blank" rel="noopener" href="https://ffmpeg.org/legal.html">FFmpeg的开源协议</a>说起了:</p>
<blockquote>
<p>FFmpeg is licensed under the GNU Lesser General Public License (LGPL) version 2.1 or later. However, FFmpeg incorporates several optional parts and optimizations that are covered by the GNU General Public License (GPL) version 2 or later. If those parts get used the GPL applies to all of FFmpeg.</p>
</blockquote>
<h3 id="怎么的就违反开源协议了呢？"><a href="#怎么的就违反开源协议了呢？" class="headerlink" title="怎么的就违反开源协议了呢？"></a>怎么的就违反开源协议了呢？</h3><ol>
<li>虽然FFmpeg使用的开源协议是LGPL，但是他用到的部分组件是GPL开源协议;</li>
<li>LGPL和GPL有着很大的区别，这个可以参考：<a target="_blank" rel="noopener" href="http://www.oschina.net/question/12_2663">关于开源授权协议 GPL 和 LGPL</a>；<br>简单来说，如果商用产品只是把LGPL的开源代码作为第三方库来使用，商用产品本身是不需要开源的，但GPL就不一样，只要你用了开源代码，整个商用产品就必须开源，这就是常说的“传染性”；</li>
<li>如果使用FFmpeg没有使用到GPL开源协议的部分组件，那么产品只要遵循LGPL就可以了，哪怕你修改了第三方库，也只需要开源修改后的第三方库代码就不算违反LGPL；</li>
<li>如果使用到了GPL开源协议的部分组件，如x264，那么商用产品就必须遵循GPL，开源商用产品的所有代码；</li>
<li>综合上面4点，可以知道如果使用了FFmpeg中使用GPL的部分组件，那么你的商用产品就必须开源，否则就是违反了GPL开源协议，要被加入FFmpeg的Hall of Shame。</li>
</ol>
<p>一不小心就上了耻辱名单，有没有什么防范措施呢？可以参考FFmpeg官方的<a target="_blank" rel="noopener" href="https://ffmpeg.org/legal.html">License Compliance Checklist</a>  </p>
<h1 id="在Mac下编译FFmpeg-2-1-4"><a href="#在Mac下编译FFmpeg-2-1-4" class="headerlink" title="在Mac下编译FFmpeg-2.1.4"></a>在Mac下编译FFmpeg-2.1.4</h1><h3 id="概要说明"><a href="#概要说明" class="headerlink" title="概要说明"></a>概要说明</h3><p>Mac开发环境，按照这篇文章来的指引编译通过：<a target="_blank" rel="noopener" href="http://www.roman10.net/how-to-build-ffmpeg-with-ndk-r9/">How to Build ffmpeg with NDK r9</a>  </p>
<p>直接按照文章的指引编译通过，只有一个步骤需要特别注意，build_android.sh中：</p>
<blockquote>
<p>TOOLCHAIN&#x3D;$NDK&#x2F;toolchains&#x2F;arm-linux-androideabi-4.8&#x2F;prebuilt&#x2F;linux-x86_64</p>
<p>改成</p>
<p>TOOLCHAIN&#x3D;$NDK&#x2F;toolchains&#x2F;arm-linux-androideabi-4.8&#x2F;prebuilt&#x2F;darwin-x86_64</p>
</blockquote>
<p>.&#x2F;build_android.sh中的路径要从linux-x86_64改成darwin-x86_64，这个我是在编译错误的时候根据提示发现下面这个路径文件找不到，才知道需要改下，修改之后就可以继续调用.&#x2F;build_android.sh编译了</p>
<h2 id="详细编译步骤"><a href="#详细编译步骤" class="headerlink" title="详细编译步骤"></a>详细编译步骤</h2><p>虽然都是按照<a target="_blank" rel="noopener" href="http://www.roman10.net/how-to-build-ffmpeg-with-ndk-r9/">How to Build ffmpeg with NDK r9</a>中的指引来操作的，我还是把操作流程简单记录如下：</p>
<ol>
<li><p>我的开发环境</p>
<blockquote>
<p>Mac OSX 10.9.2<br>XCode 5.0.2(带的gcc)<br>NDK r9d</p>
</blockquote>
</li>
<li><p>下载并配置好<a target="_blank" rel="noopener" href="http://developer.android.com/tools/sdk/ndk/index.html">NDK</a>，我之前已经配好了，不清楚的同学自己看Android的官网帮助文档 </p>
</li>
<li><p>下载<a target="_blank" rel="noopener" href="http://www.ffmpeg.org/download.html">ffmpeg源码</a>，我下载时的最新稳定版本是2.1.4，解压到NDK目录下的sources目录下</p>
</li>
<li><p>修改ffmpeg-2.1.4目录下的configure文件<br>Open ffmpeg-2.0.1&#x2F;configure file with a text editor, and locate the following lines.</p>
<blockquote>
<p>SLIBNAME_WITH_MAJOR&#x3D;’$(SLIBNAME).$(LIBMAJOR)’<br>LIB_INSTALL_EXTRA_CMD&#x3D;’$$(RANLIB) “$(LIBDIR)&#x2F;$(LIBNAME)”‘<br>SLIB_INSTALL_NAME&#x3D;’$(SLIBNAME_WITH_VERSION)’<br>SLIB_INSTALL_LINKS&#x3D;’$(SLIBNAME_WITH_MAJOR) $(SLIBNAME)’</p>
</blockquote>
<p> This cause ffmpeg shared libraries to be compiled to libavcodec.so.<version> (e.g. libavcodec.so.55), which is not compatible with Android build system. Therefore we’ll need to replace the above lines with the following lines.</p>
</li>
</ol>
<blockquote>
<p>SLIBNAME_WITH_MAJOR&#x3D;’$(SLIBPREF)$(FULLNAME)-$(LIBMAJOR)$(SLIBSUF)’<br>LIB_INSTALL_EXTRA_CMD&#x3D;’$$(RANLIB) “$(LIBDIR)&#x2F;$(LIBNAME)”‘<br>SLIB_INSTALL_NAME&#x3D;’$(SLIBNAME_WITH_MAJOR)’<br>SLIB_INSTALL_LINKS&#x3D;’$(SLIBNAME)’</p>
</blockquote>
<ol start="5">
<li><p>新建build_android.sh，下面是使用的配置，主要是开头的三个变量要根据自己机器上的情况修改成对应的路径:</p>
<p> #!&#x2F;bin&#x2F;bash<br> NDK&#x3D;&#x2F;Applications&#x2F;android-ndk-r9d<br> SYSROOT&#x3D;$NDK&#x2F;platforms&#x2F;android-9&#x2F;arch-arm&#x2F;<br> TOOLCHAIN&#x3D;$NDK&#x2F;toolchains&#x2F;arm-linux-androideabi-4.8&#x2F;prebuilt&#x2F;darwin-x86_64<br> function build_one<br> {<br> .&#x2F;configure <br> –prefix&#x3D;$PREFIX <br> –enable-shared <br> –disable-static <br> –disable-doc <br> –disable-ffmpeg <br> –disable-ffplay <br> –disable-ffprobe <br> –disable-ffserver <br> –disable-avdevice <br> –disable-doc <br> –disable-symver <br> –cross-prefix&#x3D;$TOOLCHAIN&#x2F;bin&#x2F;arm-linux-androideabi- <br> –target-os&#x3D;linux <br> –arch&#x3D;arm <br> –enable-cross-compile <br> –sysroot&#x3D;$SYSROOT <br> –extra-cflags&#x3D;”-Os -fpic $ADDI_CFLAGS” <br> –extra-ldflags&#x3D;”$ADDI_LDFLAGS” <br> $ADDITIONAL_CONFIGURE_FLAG<br> make clean<br> make<br> make install<br> }<br> CPU&#x3D;arm<br> PREFIX&#x3D;$(pwd)&#x2F;android&#x2F;$CPU<br> ADDI_CFLAGS&#x3D;”-marm”<br> build_one</p>
<p> 我一开始没留意TOOLCHAIN的路径，后面发现编译错误，才修改了build_android.sh中TOOLCHAIN的路径定义：</p>
</li>
</ol>
<blockquote>
<p>TOOLCHAIN&#x3D;$NDK&#x2F;toolchains&#x2F;arm-linux-androideabi-4.8&#x2F;prebuilt&#x2F;linux-x86_64</p>
<p>改成</p>
<p>TOOLCHAIN&#x3D;$NDK&#x2F;toolchains&#x2F;arm-linux-androideabi-4.8&#x2F;prebuilt&#x2F;darwin-x86_64</p>
</blockquote>
<ol start="6">
<li><p>保存build_android.sh，并调用执行编译<br>我直接把build_android.sh保存在了ffmpeg-2.1.4根目录下，然后执行：</p>
<blockquote>
<p>sudo chmod +x build_android.sh<br>.&#x2F;build_android.sh</p>
</blockquote>
</li>
<li><p>编译通过，在ffmpeg-2.1.4&#x2F;Android目录下生成了若干.so文件</p>
</li>
</ol>
<h2 id="解压到别的目录下去编译"><a href="#解压到别的目录下去编译" class="headerlink" title="解压到别的目录下去编译"></a>解压到别的目录下去编译</h2><p>文章中把ffmpeg的源代码解压到了NDK的sources目录下，并说明了原因：</p>
<blockquote>
<p>The reason we built our ffmpeg source code under $NDK&#x2F;sources folder is that NDK build system will search for directories under this path for external modules automatically. </p>
</blockquote>
<p>其实解压到哪里编译都可以，只是放在NDK目录下其他工程使用ffmpeg时的引用路径配置方便一点。</p>
<p>– The End –</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/05/09/2014/2014-05-09-keystone-habits/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/05/09/2014/2014-05-09-keystone-habits/" class="post-title-link" itemprop="url">核心习惯 Keystone Habits</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-05-09 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-09T00:00:00+08:00">2014-05-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="最近在看这本书：《习惯的力量》"><a href="#最近在看这本书：《习惯的力量》" class="headerlink" title="最近在看这本书：《习惯的力量》"></a>最近在看这本书：《<a target="_blank" rel="noopener" href="http://book.douban.com/subject/20507212/">习惯的力量</a>》</h2><p><img src="http://img3.douban.com/mpic/s26262254.jpg" alt="s26262254.jpg"></p>
<h2 id="突然想到核心习惯这个问题，我就发了一条推特："><a href="#突然想到核心习惯这个问题，我就发了一条推特：" class="headerlink" title="突然想到核心习惯这个问题，我就发了一条推特："></a>突然想到核心习惯这个问题，我就发了<a target="_blank" rel="noopener" href="https://twitter.com/linyehui/status/464674799520710656">一条推特</a>：</h2><blockquote>
<p>最近看《习惯的力量》，开始思考自己的核心习惯是什么？或者说应该培养怎样的核心习惯对自己的帮助最大，目前想到的是 #GTD；<br>虽然BIO中声称自己是GTD，但是GTD并不是自己目前的核心习惯；<br>这个问题还得再琢磨琢磨，但千万不能被现在的核心习惯 #三分钟热度 给抛弃了，发推备忘下</p>
</blockquote>
<h2 id="提醒自己核心习惯自我反省下"><a href="#提醒自己核心习惯自我反省下" class="headerlink" title="提醒自己核心习惯自我反省下"></a>提醒自己核心习惯自我反省下</h2><p>现在：三分钟热度<br>期望：GTD，高效，坚持</p>
<h2 id="对我影响最大的三本书："><a href="#对我影响最大的三本书：" class="headerlink" title="对我影响最大的三本书："></a>对我影响最大的三本书：</h2><p>《把时间当作朋友》<br>《习惯的力量》<br>《把信带给加西亚》</p>
<h2 id="2014-05-26-补充"><a href="#2014-05-26-补充" class="headerlink" title="2014-05-26 补充"></a>2014-05-26 补充</h2><p>场景化是习惯养成的一个重要条件，当生活的重心全部集中于一点的时候，所有的其他习惯貌似都被打乱了？在新的场景下如何养成新的习惯替代老的习惯呢？<br>习惯养成应该是有方法论的，这个问题我还要持续思考，希望未来有天我可以在这个点上向世界输出点有用的东西。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/05/07/2014/2014-05-07-set-orientation-of-a-video-recording-with-mediarecorder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/05/07/2014/2014-05-07-set-orientation-of-a-video-recording-with-mediarecorder/" class="post-title-link" itemprop="url">MediaRecorder视频录制旋转90度的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-05-07 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-07T00:00:00+08:00">2014-05-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>在Android下录制视频，录制的视频在手机（iOS和Android）上预览、播放正常;<br>在手机浏览器中播放正常;<br>在PC上的浏览器和播放器播放正常。</p>
<hr>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="预览的时候视频需要旋转90°"><a href="#预览的时候视频需要旋转90°" class="headerlink" title="预览的时候视频需要旋转90°"></a>预览的时候视频需要旋转90°</h3><p>这个可以解决，设置下摄像头显示的方向就可以了：</p>
<pre><code>// private Camera camera = null;
// 修改摄像头参数就能解决预览视频的旋转90°问题
// 具体是90还是270我这里就不具体说了，网上很多代码
camera.setDisplayOrientation(90);
</code></pre>
<p>参考文章：<a target="_blank" rel="noopener" href="http://blog.csdn.net/fengye810130/article/details/11614427">android中Camera setDisplayOrientation使用</a></p>
<h3 id="视频文件保存的时候需要旋转90°"><a href="#视频文件保存的时候需要旋转90°" class="headerlink" title="视频文件保存的时候需要旋转90°"></a>视频文件保存的时候需要旋转90°</h3><p>导致这个问题的原因是使用MediaRecorder录视频保存的文件都是“横版”的，也就是说：如果你是竖着录制视频，录制保存下来的视频本来就是“旋转了90度的”，这个问题怎么解决呢？</p>
<h4 id="一种有缺陷的解决方案"><a href="#一种有缺陷的解决方案" class="headerlink" title="一种有缺陷的解决方案"></a>一种有缺陷的解决方案</h4><p>Android 2.3(API Level 9)之后提供了setOrientationHint方法，但这并不是完美的方案，不是所有的播放起都支持这个设置，看下官方文档:<a target="_blank" rel="noopener" href="http://developer.android.com/reference/android/media/MediaRecorder.html#setOrientationHint">setOrientationHint</a></p>
<blockquote>
<p>Sets the orientation hint for output video playback. This method should be called before prepare(). This method will not trigger the source video frame to rotate during video recording, but to add a composition matrix containing the rotation angle in the output video if the output format is OutputFormat.THREE_GPP or OutputFormat.MPEG_4 so that a video player can choose the proper orientation for playback. Note that some video players may choose to ignore the compostion matrix in a video during playback.</p>
</blockquote>
<p>关键是这句：</p>
<blockquote>
<p>Note that some video players may choose to ignore the compostion matrix in a video during playback.</p>
</blockquote>
<p>这就是我为什么说这是一种有缺陷的解决方案，但这个方案足够简单，只用Android SDK就够了，一句代码搞定：</p>
<pre><code>// private MediaRecorder mediaRecorder = null;
// 用VideoView,Safari,QuickTime Player播放视频，视频角度是正确的
// 用Chrome,QQPlayer,MPlayerX播放视频，视频需要旋转90°才正确
mediaRecorder.setOrientationHint(90);
</code></pre>
<p><strong>补充说明：</strong></p>
<ol>
<li>使用这个方案并不能完美解决问题，在Chrome,QQPlayer,MPlayerX等播放器中，视频都无法按照“预设的角度”被播放，因为这些播放器并不支持setOrientationHint的这种格式设置；</li>
<li>如果非要使用这个方案，可以在HTML5中使用CSS对video标签进行旋转，但这样会把整个标签，包括控制条都旋转掉，有个猥琐的解决方案是不显示自带的控制条，而是自己实现简单的控制（播放，暂停）</li>
</ol>
<p>参考文章：<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/12486870/chrome-html5-video-flipping-portrait-sideways">Chrome HTML5 Video Flipping Portrait Sideways</a></p>
<h4 id="可能的完美方案-未验证"><a href="#可能的完美方案-未验证" class="headerlink" title="可能的完美方案(未验证)"></a>可能的完美方案(未验证)</h4><p>使用FFMpeg或者OpenCV对录制的视频进行旋转</p>
<ol>
<li>对录制后的文件进行直接的FFMpeg旋转</li>
<li>对录制过程中的每一帧进行旋转，最后生成的文件自然也是正确旋转了的</li>
</ol>
<p>有个有点沾边的参考文章：[<a target="_blank" rel="noopener" href="https://groups.google.com/forum/#!msg/javacv/J0O6jV8kK9k/cu0iY6fyNWAJ">https://groups.google.com/forum/#!msg/javacv/J0O6jV8kK9k/cu0iY6fyNWAJ</a> Can I set the orientation of a video when recording with FfmpegFrameRecorder?]</p>
<p>未完待续……</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/04/21/2014/2014-04-21-using-beyond-compare-in-mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/04/21/2014/2014-04-21-using-beyond-compare-in-mac/" class="post-title-link" itemprop="url">在Mac下使用Beyond Compare</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-04-21 00:00:00" itemprop="dateCreated datePublished" datetime="2014-04-21T00:00:00+08:00">2014-04-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><ul>
<li>Windows下的Beyond Compare是个神器，Mac下也有，那么怎么在Mac下使用Beyond Compare呢？</li>
<li>本文所使用的Beyond Compare是官网下载的Beta版本，版本号：Version 4.0 beta (build 17905)，安装包我是从<a target="_blank" rel="noopener" href="http://www.scootersoftware.com/support.php?zz=kb_mac">官网</a>下载到的。</li>
</ul>
<h3 id="Mac下命令行使用Beyond-Compare"><a href="#Mac下命令行使用Beyond-Compare" class="headerlink" title="Mac下命令行使用Beyond Compare"></a>Mac下命令行使用Beyond Compare</h3><p>Mac下的Beyond Compare 4，如果要使用命令行，需要从Beyond Compare的菜单上先安装下命令行工具：</p>
<blockquote>
<p>Beyond Compare -&gt; Install Command Line Tools …<br>安装之后你就能得到：<br>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;bcomp:<br>Launches comparison and waits for it to complete.</p>
<p>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;bcompare:<br>Launches comparison and returns immediately.<br>参考：<a target="_blank" rel="noopener" href="http://www.scootersoftware.com/vbulletin/showthread.php?t=11677&highlight=sourcetree">Using BC4 OSX with Version Control Systems</a></p>
</blockquote>
<h3 id="在git中使用Beyond-Compare"><a href="#在git中使用Beyond-Compare" class="headerlink" title="在git中使用Beyond Compare"></a>在git中使用Beyond Compare</h3><p>直接修改.gitconfig就可以了</p>
<blockquote>
<p>[diff]<br>    tool &#x3D; bcomp<br>[difftool]<br>    prompt &#x3D; false<br>[difftool “bcomp”]<br>    trustExitCode &#x3D; true<br>    cmd &#x3D; “&#x2F;usr&#x2F;local&#x2F;bin&#x2F;bcomp” “$LOCAL” “$REMOTE”<br>[merge]<br>    tool &#x3D; bcomp<br>[mergetool]<br>    prompt &#x3D; false<br>[mergetool “bcomp”]<br>    trustExitCode &#x3D; true<br>    cmd &#x3D; “&#x2F;usr&#x2F;local&#x2F;bin&#x2F;bcomp” “$LOCAL” “$REMOTE” “$BASE” “$MERGED”</p>
</blockquote>
<p>参考：<a target="_blank" rel="noopener" href="http://www.scootersoftware.com/vbulletin/showthread.php?t=11677&highlight=sourcetree">Using BC4 OSX with Version Control Systems</a></p>
<h3 id="在SourceTree中配置Beyond-Compare"><a href="#在SourceTree中配置Beyond-Compare" class="headerlink" title="在SourceTree中配置Beyond Compare"></a>在SourceTree中配置Beyond Compare</h3><p>1.首先你要确认你已经从Beyond Compare菜单上安装了命令行工具<br>2.在SourceTree的Preferences中配置</p>
<blockquote>
<p>Visual Diff Tool: Other<br>Diff Command:&#x2F;usr&#x2F;local&#x2F;bin&#x2F;bcomp<br>Parameters:$LOCAL $REMOTE<br>Merge Tool: Other<br>Merge Command:&#x2F;usr&#x2F;local&#x2F;bin&#x2F;bcomp<br>Paramters:$LOCAL $REMOTE $BASE $MERGED</p>
</blockquote>
<p>参考：<a target="_blank" rel="noopener" href="http://www.scootersoftware.com/vbulletin/showthread.php?t=11695&highlight=sourcetree">SourceTree configuration</a></p>
<hr>
<p>喜欢Beyond Compare的话就支持正版吧 :)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/04/12/2014/2014-04-12-config-cygwin-and-ndk-build/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/04/12/2014/2014-04-12-config-cygwin-and-ndk-build/" class="post-title-link" itemprop="url">Windows下配置cygwin和ndk编译环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-04-12 00:00:00" itemprop="dateCreated datePublished" datetime="2014-04-12T00:00:00+08:00">2014-04-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="cygwin安装"><a href="#cygwin安装" class="headerlink" title="cygwin安装"></a>cygwin安装</h1><blockquote>
<p>正确的安装步骤其实很简单：</p>
<ol>
<li>下载setup-86_64.exe</li>
<li>直接从网上下载安装，选择包时，顶部选择“default”不变</li>
<li>搜索make，勾选make，cmake，emacs-cmake,libjepg</li>
<li>Shells这个二级目录选择“install”</li>
<li>下一步，开始安装</li>
<li>安装完成后调用下make命令看下是否已经安装成功（其实最直接的是测试下ndk-build）</li>
<li>上面提到的这些包一起，下载后的目录是82MB左右，下载了的话肯定是哪里配置错了，不需要那么多东西。</li>
</ol>
</blockquote>
<h4 id="结论很简单，不过我折腾的过程就有点心酸了："><a href="#结论很简单，不过我折腾的过程就有点心酸了：" class="headerlink" title="结论很简单，不过我折腾的过程就有点心酸了："></a>结论很简单，不过我折腾的过程就有点心酸了：</h4><h5 id="1-坑爹的安装界面交互"><a href="#1-坑爹的安装界面交互" class="headerlink" title="1.坑爹的安装界面交互"></a>1.坑爹的安装界面交互</h5><p>下载setup-x86_64.exe，出现包选择的时候，我点击了下“default”，变成了“install”，那时我像，哦～应该是这样吧，然后我就点了下一步，结果我下了差不多半天，下完发现那个有2G多还是3G，什么乱七八糟的都给我下载下来了。</p>
<p>这个方法明显不对，所以我过段把下载完的东西全删了。</p>
<h5 id="2-默认安装"><a href="#2-默认安装" class="headerlink" title="2.默认安装"></a>2.默认安装</h5><p>其实打开setup-x86_64.exe后，选择包的那个界面，保持根上的那个“default”不动，就是默认安装，默认安装几分钟就装好了</p>
<h5 id="3-缺什么包选什么包"><a href="#3-缺什么包选什么包" class="headerlink" title="3.缺什么包选什么包"></a>3.缺什么包选什么包</h5><p>默认安装后测试下make命令会发现，make都没有安装；<br>这个时候也好办，提示你缺什么包，你就回到setup-x86_64.exe，在包选择界面filter进行查找，然后勾选，下一步安装。</p>
<p>测试总结之后，我发现把这几个勾选上，基本的ndk-build已经够用了：</p>
<blockquote>
<p>make，cmake，emacs-cmake,libjepg,Shells整个二级目录<br>这些个下载下来的文件也就82MB多。</p>
</blockquote>
<h5 id="4-测试安装是否正常"><a href="#4-测试安装是否正常" class="headerlink" title="4.测试安装是否正常"></a>4.测试安装是否正常</h5><p>因为ndk-build会用到make，所以安装完cygwin后，桌面快捷方式打开cygwin，然后测试下make命令，如果提示正常，那就是cygwin安装成功了。</p>
<h5 id="5-不要装写没用的，用到什么装什么"><a href="#5-不要装写没用的，用到什么装什么" class="headerlink" title="5.不要装写没用的，用到什么装什么"></a>5.不要装写没用的，用到什么装什么</h5><p>cygwin安装成功的话setup-x86_64.exe是不会有什么错误提示的，如果你装的包越多，cygwin对系统的依赖也就越多，反而会出些不兼容的安装错误。</p>
<p>一开始的时候会提示一个bash错误，后面我发现是我装msysgit时带的bash冲突了，我就先吧msysgit卸载了再安装cygwin就好了。<br>然后重新安装msysgit时记得选择默认的bash选项：Git Bash only</p>
<p>网上还有文章说ndk编译需要依赖devel和editors，要是傻傻勾选了这两个包目录，那就有得你下载了，其实只需要其中的make相关的几个包就够了，不用整个二级目录都“install”。</p>
<p>Shells目录因为比较小，直接勾选上问题不大。</p>
<h4 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h4><p><a target="_blank" rel="noopener" href="http://my.oschina.net/tonywolf/blog/49214">android-ndk-r7b编译环境Cygwin工具搭建及配置</a></p>
<h1 id="ndk-build解压并配置"><a href="#ndk-build解压并配置" class="headerlink" title="ndk-build解压并配置"></a>ndk-build解压并配置</h1><ol>
<li><p>解压ndk压缩包</p>
</li>
<li><p>配置环境变量，在C:\cygwin64\home\linyehui.bash_profile最后添加两行</p>
<blockquote>
<p>export ANDROID_NDK_HOME&#x3D;&#x2F;cygdrive&#x2F;c&#x2F;android-ndk-r9c<br>export PATH&#x3D;$ANDROID_NDK_HOME:$PATH</p>
</blockquote>
</li>
<li><p>测试ndk-build<br>bash下直接测试下ndk-build命令，提示正常的话就是安装成功了。</p>
</li>
</ol>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>网上的教程挺多的，但没有一个写的特别明白，大多都是让你“全部安装”，或者勾选一大堆，用个cygwin要下载1～2G！这就像电脑开机有点慢，有人跟你说重装系统！！</p>
<p>写这个文章也是希望自己做每个事情都能认真的琢磨透，而不是为了达到目的敷衍了事，回头一遇到点小变化，就还得折腾很久，还不如一次搞定，这才是聪明的懒人。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/04/09/2014/2014-04-09-char-is-different-in-ios-and-android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/04/09/2014/2014-04-09-char-is-different-in-ios-and-android/" class="post-title-link" itemprop="url">char的定义在iOS和Android下是不同的</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-04-09 00:00:00" itemprop="dateCreated datePublished" datetime="2014-04-09T00:00:00+08:00">2014-04-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>char is different in iOS and Android!</strong><br><strong>跨平台开发时很容易忽略的非常坑爹的一个区别。</strong></p>
<hr>
<p>我的需求是实现一个算法，这个算法在iOS和Android下需要保持一致的结果，很自然的我用C++实现了一份跨平台(cross-platform)代码，在两个平台都可以用，但这份代码在iOS和Android下竟然出现了不同的结果，排查了很久后发现了这个不同：</p>
<blockquote>
<p>iOS下char is signed，Android下char is unsigned<br>也就是说，在iOS下这两个定义是等同的：<br>char cNum &#x3D; 100;<br>signed char cNum &#x3D; 100;</p>
</blockquote>
<p>而在Android下这两个定义是等同的：</p>
<blockquote>
<p>char cNum &#x3D; 100;<br>unsigned char cNum &#x3D; 100;</p>
</blockquote>
<p>当你用char进行运算的时候，signed和unsigned是有正负号差异的，会导致你的结果变得莫名其妙。</p>
<p>这个代码在iOS和Android下代码执行结果是不一样的</p>
<blockquote>
<p>char cNum &#x3D; 0x80;<br>float fResult &#x3D; cNum + 80;</p>
</blockquote>
<p><strong>解决方案：</strong><br>声明char类型的变量时，明确写上是signed char还是unsigned char。</p>
<p>发现了问题之后，再反过来找资料的时候发现了这个，不得不感慨：问题总在解决之后突然就变得简单了：<br><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/21467195/c-compiler-differences-for-ios-and-android-development">C Compiler differences for iOS and Android development</a></p>
<blockquote>
<p>In your Android C implementation, char is unsigned, and the conversion from -7 in double to char is producing zero. (The behavior of this conversion when the value cannot be represented in the destination type is not defined by the C standard.)</p>
<p>In iOS, char is signed, and the conversion of -7 in double to char produces -7.</p>
</blockquote>
<p>PS.<br>特别要说明下我的开发工具版本：<br>XCode:5.0.2<br>官方ADT：22.3.0</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/03/23/2014/2014-03-23-how-to-debug-ndk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/03/23/2014/2014-03-23-how-to-debug-ndk/" class="post-title-link" itemprop="url">如何调试NDK</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2014-03-23T00:00:00+08:00">2014-03-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用C++编写跨平台lib，提供给iOS和Android使用，那么NDK是必然要用到的，那么怎么调试NDK呢？<br>网上的教程挺多的，但是跟着做下来后还是遇到了不少诡异的问题，对于Android新手的我来说还是有点摸不着头脑，解决后在这备忘下。</p>
<h4 id="我遇到的问题"><a href="#我遇到的问题" class="headerlink" title="我遇到的问题"></a>我遇到的问题</h4><p>首先我照着这个教程:<a target="_blank" rel="noopener" href="http://blog.micro-studios.com/?p=4212">利用JNI技术在Android中调用、调试C++代码</a>写了个HelloWorld，而且可以“Debug As Android Application”跑起来，但是我想要“Debug As Android Native Application” 的时候就遇到了下面这些问题：</p>
<h5 id="1-提示-Unknown-Application-ABI"><a href="#1-提示-Unknown-Application-ABI" class="headerlink" title="1.提示 Unknown Application ABI:"></a>1.提示 Unknown Application ABI:</h5><p>你会发现Console中有很多行这个提示，但是其实这个提示是可以先忽略掉的，你可以拿个文本编辑器把重复的这些提示过滤掉，这样你就能看到真正的错误提示了；<br>我看到的是我的第二个问题</p>
<h5 id="2-提示-Android-NDK-WARNING-APP-PLATFORM-android-19-is-larger-than-android-minSdkVersion-16"><a href="#2-提示-Android-NDK-WARNING-APP-PLATFORM-android-19-is-larger-than-android-minSdkVersion-16" class="headerlink" title="2.提示 Android NDK: WARNING: APP_PLATFORM android-19 is larger than android:minSdkVersion 16"></a>2.提示 Android NDK: WARNING: APP_PLATFORM android-19 is larger than android:minSdkVersion 16</h5><p>解决方案1，这个提示我暂时还没弄明白原理，但是有个最简单的方法来解决：<br>到AndroidManifest.xml中把这两个字段都改成最大的版本号</p>
<blockquote>
<p>android:minSdkVersion&#x3D;”19”<br>android:targetSdkVersion&#x3D;”19”</p>
</blockquote>
<p>解决方案2：<br>到SDK Manager中去下载对应版本的Android SDK Build-tools和SDK Platform</p>
<h5 id="3-模拟器调试"><a href="#3-模拟器调试" class="headerlink" title="3.模拟器调试"></a>3.模拟器调试</h5><p>自带的模拟器有多慢大家肯定是知道的，方便调试我使用的是Genymotion，但是后面我发现Genymotion是不支持Debug As Android Native Application的，会提示下面这个，暂时还没找到问题的解决方案：</p>
<blockquote>
<p>[2014-03-23 17:28:00 - HelloNDK] Unable to find a compatible ABI<br>[2014-03-23 17:28:00 - HelloNDK] ABI’s supported by the application: armeabi<br>[2014-03-23 17:28:00 - HelloNDK] ABI’s supported by the device: x86, armeabi-v7a</p>
</blockquote>
<h5 id="4-提示"><a href="#4-提示" class="headerlink" title="4.提示"></a>4.提示</h5><p>[2013-06-25 15:25:22 - TestNDK2] gdbserver output:<br>[2013-06-25 15:25:22 - TestNDK2] run-as: exec failed for lib&#x2F;gdbserver Error:No such file or directory<br>[2013-06-25 15:25:22 - TestNDK2] Verify if the application was built with NDK_DEBUG&#x3D;1</p>
<p><strong>解决方案：</strong>  </p>
<p>1.确认编译选项是否加了NDK_DEBUG&#x3D;1  </p>
<p>2.已经加了还是不行，终端中输入下adb看看是不是adb命令不可用，是的话，配置下.bash_profile，把adb的路径加进去，加PATH可以参考<a target="_blank" rel="noopener" href="http://gushedaoren.blog.163.com/blog/static/17366340520124300630343/">这个</a>  </p>
<p>3.用这个命令把gdb_server push到Android手机或模拟器上  </p>
<blockquote>
<p>adb push &#x2F;Applications&#x2F;android-ndk-r9d&#x2F;prebuilt&#x2F;android-arm&#x2F;gdbserver&#x2F;gdbserver &#x2F;data<br>参考这个：<a target="_blank" rel="noopener" href="http://hi.baidu.com/linuxcfan/item/4d6a07ee9fcdb2255b2d64df">通过gdbserver实现远程调试</a>   </p>
</blockquote>
<h5 id="5-NDK调试提示错误："><a href="#5-NDK调试提示错误：" class="headerlink" title="5.NDK调试提示错误："></a>5.NDK调试提示错误：</h5><blockquote>
<p>No symbol table is loaded.  Use the “file” command.  </p>
</blockquote>
<p>使用ndk-gdb –start 启动程序第一个activity，但是此时so文件并没有被加载。解决方法：首先打开程序并使用，在保证so文件已经被使用的情况下，调用ndk-gdb命令调试程序进程。<br>正确流程：1.创建一个模拟器或者使用真机运行想要调试的程序，确保so文件已经被加载。<br>一个比较简单的方法，在load so库的java文件中添加一个无关紧要的方法，比如：<br>Java代码  收藏代码<br>public static void test1(){  </p>
<pre><code>Log.i(tag, &quot;test1&quot;);  
</code></pre>
<p>}  </p>
<p>然后在主activity起来的时候，调用一下这个方法就OK了。<br>参考这篇文章：<a target="_blank" rel="noopener" href="http://qiang106.iteye.com/blog/1830416">android NDK开发、编译、调试环境搭建与操作入门</a>  </p>
<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><p>网上的教程挺多的，我参考了下面这几篇：<br><a target="_blank" rel="noopener" href="http://developer.android.com/tools/sdk/ndk/index.html">Android官网</a>  </p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/wutianyin222/article/details/8222838">超简单的NDK单步调试方法</a>  </p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/wjr2012/article/details/7993722">eclipse下ndk调试</a>  </p>
<p><a target="_blank" rel="noopener" href="http://www.aiseminar.cn/bbs/home.php?mod=space&uid=3&do=blog&id=2735">【暗黑世界】NDK调试的设置方法</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://linyehui.me/2014/02/14/2014/2014-02-14-what-is-noise-reduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="linyehui">
      <meta itemprop="description" content="HABIT IS POWER">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HABIT IS POWER">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/02/14/2014/2014-02-14-what-is-noise-reduction/" class="post-title-link" itemprop="url">什么是声音降噪</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-02-14 00:00:00" itemprop="dateCreated datePublished" datetime="2014-02-14T00:00:00+08:00">2014-02-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>降噪是什么？其实我们一直在享受这个技术给我们带来的方便，只是我们不知道，本文的主题是简单的介绍双MIC降噪，并索引你进行更深入的了解。</p>
<h4 id="双MIC降噪"><a href="#双MIC降噪" class="headerlink" title="双MIC降噪"></a>双MIC降噪</h4><p>科技改变生活，iPhone等目前主流手机都在使用这项技术：双MIC降噪</p>
<p><strong>具体是个什么东西呢？来看下通俗解释：</strong></p>
<blockquote>
<p>所谓“双mic抗噪技术”是指通过技术处理，将外界的噪音消除而在这之中的“技术处理”，就是内置的2个麦克风，一个稳定保持清晰通话，另一个麦克风物理主动消除噪音。  </p>
</blockquote>
<p>引申阅读：<a target="_blank" rel="noopener" href="http://tieba.baidu.com/p/2126118342">★双MIC降噪原理及优缺点分析（技术贴）</a></p>
<p>对于这个技术的解释，这篇文章介绍的很接地气：<a target="_blank" rel="noopener" href="http://www.igao7.com/reduce-noice.html">手机麦克风是如何消除环境噪音的？</a></p>
<p><strong>这是一篇关于iPhone5的介绍，从中我们也可以发现苹果对这个技术的使用和加强：</strong></p>
<blockquote>
<p>相较iPhone 4以及4S的双麦克，iPhone 5拥有更好的降噪能力。除了仍旧在底部的主麦克风外，还拥有听筒位置以及背部摄像头附近的两个降噪麦。传统双麦降噪手机，通过主麦克以及降噪麦克过滤相同环境噪音，已达到强化用户声音的目的。这样一来，无论身处何处，周围的噪音都会有一定程度的削减。</p>
<p>然而iPhone 5的三麦设计，主要是解决在嘈杂环境下听不清听筒声音的问题。这也就是为什么第二个降噪麦，从机身顶部挪到了听筒的位置。通过背部摄像头附近的麦收集环境噪音，以及听筒附近降噪麦计算用户耳朵贴合手机的角度和距离，测算后从听筒发出干扰声波，以达到降低噪音的功效。</p>
<p>实测iPhone 5在安静环境下，通话质量与iPhone 4&#x2F;4S并无大异，然而在周围噪音繁杂的环境下，听筒音量并无显著提高，但是噪音过滤比较明显，可以清晰收听对方的声音。    </p>
</blockquote>
<p>引申阅读：<a target="_blank" rel="noopener" href="http://tech.sina.com.cn/mobile/n/2012-09-21/11497643200.shtml">体验全面提升 苹果iPhone 5评测</a></p>
<h4 id="术语解释"><a href="#术语解释" class="headerlink" title="术语解释"></a>术语解释</h4><p><a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Noise_reduction">Noise reduction</a>  </p>
<p><a target="_blank" rel="noopener" href="http://www.multimediasignalprocessing.com/PDF/tutorial6.pdf">Microphone Arrays : A Tutorial</a></p>
<p>中文的降噪我没找到专业的术语解释</p>
<h4 id="其他的引申阅读："><a href="#其他的引申阅读：" class="headerlink" title="其他的引申阅读："></a>其他的引申阅读：</h4><p><a target="_blank" rel="noopener" href="http://tieba.baidu.com/p/2126118342">★双MIC降噪原理及优缺点分析（技术贴）</a>  </p>
<p><a target="_blank" rel="noopener" href="http://bbs.21ic.com/icview-244981-1-1.html">求双MIC的DSP降噪算法？</a>  </p>
<p><a target="_blank" rel="noopener" href="http://scholar.google.com/scholar?q=%E5%8F%8CMIC%E6%B6%88%E5%99%AA%E6%8A%80%E6%9C%AF&hl=zh-CN&as_sdt=0&as_vis=1&oi=scholart&sa=X&ei=H8X9UvOUJKaWiQea0oDADQ&ved=0CCcQgQMwAA">Google学术搜索：双MIC消噪技术</a>  </p>
<p><a target="_blank" rel="noopener" href="http://www.docin.com/p-260511024.html">双MIC消噪技术 资料整理</a>  </p>
<p><a target="_blank" rel="noopener" href="http://bbs.gfan.com/android-4421314-1-1.html">MOTO丽音技术深度解析，帮助大家了解丽音</a>  </p>
<p><a target="_blank" rel="noopener" href="http://www.miui.com/thread-1011253-1-1.html">为什么小米2在安静环境下通话效果差？双MIC降噪原理解析</a>  </p>
<p><a target="_blank" rel="noopener" href="http://www.slideshare.net/lpzhang/demo-victor-cqf">声学降噪技术</a>  </p>
<p><a target="_blank" rel="noopener" href="http://qing.blog.sina.com.cn/tj/564012ca330025hg.html">《看不出的创新，听得见的改变——谈 iPhone 5的通话性能提升》</a>  </p>
<p><a target="_blank" rel="noopener" href="http://bbs.52rd.com/Thread-202698-1-1.html">双MIC消噪技术</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">linyehui</p>
  <div class="site-description" itemprop="description">HABIT IS POWER</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">143</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">178</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">linyehui</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
